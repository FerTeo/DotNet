<br />
<br />

@if (TempData["message"] != null)
{
    <div class="alert @ViewBag.Alert p-3 rounded-3 text-center mb-5">
        @TempData["message"]
    </div>
}

<br />

<div class="row">
    @foreach (var group in ViewBag.Groups ?? new List<OSSocial.Models.Group>())
    {
        var status = ViewBag.MembershipStatus?[group.Id];
        var isMember = status?.IsMember ?? false;
        var hasPending = status?.HasPending ?? false;
        var isOwner = group.UserId == ViewBag.UserCurent;

        <div class="col-4 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">@group.Name</h5>

                    @if (!group.IsPublic)
                    {
                        <span class="badge bg-danger mb-2">Private</span>
                    }

                    @if (isOwner)
                    {
                        <span class="badge bg-primary mb-2">Owner</span>
                    }

                    <br />

                    <a asp-controller="Groups" asp-action="GroupProfile" asp-route-id="@group.Id" 
                       class="btn btn-dark btn-sm">
                        Show group profile
                    </a>

                    @* Show Join button only if: not owner, not member, no pending request *@
                    @if (!isOwner && !isMember && !hasPending)
                    {
                        <form asp-controller="Groups" asp-action="JoinGroup" method="post" style="display:inline;">
                            <input type="hidden" name="GroupId" value="@group.Id" />
                            <button type="submit" class="btn btn-success btn-sm">Join</button>
                        </form>
                    }
                    else if (hasPending && !isOwner)
                    {
                        <span class="badge bg-warning">Pending approval</span>
                    }
                    else if (isMember && !isOwner)
                    {
                        <span class="badge bg-info">Member</span>
                    }
                </div>
            </div>
        </div>
    }
</div>

<a asp-controller="Groups" asp-action="Create"
   class="btn btn-success shadow-lg"
   title="Create a new group"
   style="
       position: fixed; 
       bottom: 100px; 
       left: 50%; 
       transform: translateX(-50%); 
       width: 60px; 
       height: 60px; 
       border-radius: 50%; 
       display: flex; 
       align-items: center; 
       justify-content: center; 
       z-index: 1000;">
    
    <i class="bi bi-plus-lg" style="font-size: 1.8rem;">+</i>
</a>
