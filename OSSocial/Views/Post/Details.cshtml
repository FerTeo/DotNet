@model OSSocial.Models.Post
@{
    ViewData["Title"] = "See post details";
}
<h1>@ViewData["Title"]</h1>

<br>
<p>@Model.Title</p>
<p>@Model.Content</p>
<p>@Model.Time</p>

@if (!string.IsNullOrEmpty(Model.Media))
{
    @* doar dacă nu e null, verificăm extensia *@
    if (Model.Media.EndsWith(".mp4", StringComparison.OrdinalIgnoreCase) || Model.Media.EndsWith(".mov", StringComparison.OrdinalIgnoreCase))
    {
        <video width="550" height="300" controls>
            <source src="@Model.Media" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    }
    else
    {
        @* dacă nu e video, e imagine *@
        <img src="@Model.Media" alt="Article Image" style="width: 100%; max-width: 550px; height: auto; object-fit: cover; border-radius: 10px;" />
    }
}

<br/>
<form asp-action="Delete" asp-controller="Post" asp-route-id="@Model.Id" method="post">
    @Html.AntiForgeryToken()
    <button type="submit" class="btn btn-danger">Delete Post</button>
</form>

@await Html.PartialAsync("_ReactionsPartial", Model.Id)

<br/>

<a asp-controller="Post" asp-action="Feed">Return to feed</a>

<br/>


@foreach (var comm in Model.Comments)
{
    <div class="container" style="max-width: 40%;">
        <div class="row">
            <div class="col-md-2"></div>

            <div class="col-md-8">

                <div style="margin-block: auto; padding: 10px; border: 1px solid #ccc; border-radius: 5px; right: auto; left: auto" >
                    <div>
                        <strong><i class="bi bi-person"> @comm.User.UserName</i></strong>
                    </div>
                    <br/>
                    
                    <p>@comm.Content</p>
                    <small>@comm.DateCreated</small>
                    
                    @* Afisare eticheta sentiment - vizibila doar pentru Admin *@
                    @* @if (ViewBag.EsteAdmin == true && comm.SentimentLabel != null) *@
                    @* { *@
                    @*     var badgeClass = comm.SentimentLabel switch *@
                    @*     { *@
                    @*         "positive" => "bg-success", *@
                    @*         "negative" => "bg-danger", *@
                    @*         _ => "bg-secondary" *@
                    @*     }; *@
                    @*     var sentimentIcon = comm.SentimentLabel switch *@
                    @*     { *@
                    @*         "positive" => "bi-emoji-smile", *@
                    @*         "negative" => "bi-emoji-frown", *@
                    @*         _ => "bi-emoji-neutral" *@
                    @*     }; *@
                    @*     <span class="badge @badgeClass ms-2"> *@
                    @*         <i class="bi @sentimentIcon"></i> *@
                    @*         @comm.SentimentLabel *@
                    @*         (@(comm.SentimentConfidence?.ToString("P0"))) *@
                    @*     </span> *@
                    @* } *@
                </div>
                <br>

                @if (comm.UserId == ViewBag.CurrentUserId || ViewBag.EsteAdmin == true)
                {
                    <div class="d-flex">
                        <div>
                            <a class="btn btn-outline-primary" asp-controller="Comments" asp-action="Edit" asp-route-id="@comm.Id">
                                <i class="bi bi-pencil-square"></i> Editeaza
                            </a>

                        </div>
                        <div>
                            <form method="post" asp-controller="Comments" asp-action="Delete" asp-route-id="@comm.Id">

                                <button class="btn btn-outline-danger" type="submit"><i class="bi bi-trash"></i>Sterge</button>

                            </form>
                        </div>
                    </div>
                }

                <br />

            </div>

            <div class="col-md-2"></div>

        </div>

    </div>
}


@* Afisarea formularului in care se poate adauga un comentariu
    Doar pt utilizator logat *@
@if (User.Identity.IsAuthenticated)
{
    <div class="container">
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <div class="card">
                    <form method="post" asp-controller="Comments" asp-action="New">
                        <div class="card-body">

                            <input type="hidden" name="PostId" value="@Model.Id" />

                            <label>What do you want to say? :3</label>
                            <br />
                            <textarea name="Content" class="form-control"></textarea>
                            
                            <br />
                            
                            @if (Context.Request.Query["err"] == "empty")
                            {
                                <div class="alert alert-danger">
                                    Can't post an empty comment :(
                                </div>
                            }
                            
                            <br /><br />
                            
                            <button class="btn btn-success " type="submit">Add comment!</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-md-2"></div>
        </div>
    </div>
}
else
{
    <div @* class="text-center mt-4"*@> 
        <p>You must be logged in to leave a comment.</p>
    </div>
}